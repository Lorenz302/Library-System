<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Library Management System</title>
  <link rel="stylesheet" href="styles.css">
  
  <!-- ================================================================ -->
  <!-- ============ STYLES FOR PASSWORD TOGGLE ICON =================== -->
  <!-- ================================================================ -->
  <style>
    /* A wrapper to position the icon relative to the input field */
    .password-wrapper {
      position: relative;
      width: 100%;
    }
    
    /* Make sure the input field doesn't overlap with the icon */
    .password-wrapper input {
      width: 100%;
      padding-right: 45px; /* Add space for the icon */
      box-sizing: border-box; /* Ensures padding is included in the width */
    }

    /* Styles for the icon container */
    .toggle-password {
      position: absolute;
      right: 10px; /* Position icon on the right */
      top: 50%; /* Move the top of the icon to the vertical middle of the wrapper */
      transform: translateY(calc(-50% - 7px));
      cursor: pointer;
      user-select: none; /* Prevents the icon from being highlighted as text */
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
    }

    /* Style the SVG icon itself */
    .toggle-password svg {
      width: 20px;
      height: 20px;
      stroke: #9ca3af; /* A neutral gray color, works for light/dark themes */
    }
  </style>
</head>
<body>
  <!-- Landing Section -->
  <div class="landing-container">
    <div class="logo">
      <img src="LIBRARY_LOGO.png" alt="Library Logo">
    </div>
    <div class="content">
      <h1>Welcome to the Library Management System of <br> Bataan Heroes Memorial College</h1>
      <p><i>This platform is designed to make accessing and managing library resources easier for everyone. </i><br></p>
      <button id="proceedBtn" class="button">CLICK HERE TO PROCEED</button>
    </div>
  </div>

  <!-- Modal Popup -->
  <div class="modal" id="formModal">
    <div class="modal-content">
      <span class="close-btn" id="closeModal">&times;</span>

      <!-- Tabs -->
      <div class="tabs">
        <button id="signup-tab" class="active">Sign Up</button>
        <button id="login-tab">Log-In</button>
      </div>

      <!-- Sign Up Form -->
      <form class="form active" id="signup-form" action="../backend/register.php" method="POST">
        <h2>Sign Up</h2>
        <p>Create a new library account</p>
        <label for="studentId">Student ID</label>
        <input type="text" id="studentId" name="id_number" required>
        
        <label for="fullName">Full Name*</label>
        <input type="text" id="fullName" name="fullname" required>
        
        <label for="programAndYear">Program and Year*</label>
        <input type="text" id="programAndYear" name="program_and_year" placeholder="e.g., BSIT - 3" required>
        
        <label for="email">Email*</label>
        <input type="email" id="email" name="email" required>
        
        <label for="password">Password*</label>
        <div class="password-wrapper">
          <input type="password" id="password" name="password" required>
          <span class="toggle-password" id="togglePassword"></span>
        </div>
        
        <label for="confirmPassword">Confirm Password*</label>
        <div class="password-wrapper">
          <input type="password" id="confirmPassword" name="confirm_password" required>
          <span class="toggle-password" id="toggleConfirmPassword"></span>
        </div>
        
        <button type="submit">Sign up</button>
      </form>

      <!-- Login Form -->
      <form class="form" id="login-form" action="../backend/login.php" method="POST">
        <h2>Log-In</h2>
        <p>Access your library account</p>
        <label for="loginStudentId">Student/Employee ID*</label>
        <input type="text" id="loginStudentId" name="id_number" required>
        
        <label for="loginEmail">Email*</label>
        <input type="email" id="loginEmail" name="email" required>
        
        <label for="loginPassword">Password*</label>
        <div class="password-wrapper">
          <input type="password" id="loginPassword" name="password" required>
          <span class="toggle-password" id="toggleLoginPassword"></span>
        </div>
        <div class="loginbutton"> 
            <button type="submit">Log-In</button>
        </div>
      </form>
    </div>
  </div>

  
<script>
    // Get all the elements from the page
    const proceedBtn = document.getElementById("proceedBtn");
    const modal = document.getElementById("formModal");
    const closeModal = document.getElementById("closeModal");
    const signupTab = document.getElementById("signup-tab");
    const loginTab = document.getElementById("login-tab");
    const signupForm = document.getElementById("signup-form");
    const loginForm = document.getElementById("login-form");

    // A function to clear the login form fields
    function clearLoginForm() {
      loginForm.reset(); 
    }

    // Event Listeners for Modal and Tabs
    proceedBtn.addEventListener("click", () => {
      modal.style.display = "flex";
      signupTab.classList.add("active");
      loginTab.classList.remove("active");
      signupForm.classList.add("active");
      loginForm.classList.remove("active");
    });

    closeModal.addEventListener("click", () => {
      modal.style.display = "none";
      clearLoginForm(); 
    });

    window.addEventListener("click", (e) => {
      if (e.target === modal) {
        modal.style.display = "none";
        clearLoginForm(); 
      }
    });

    signupTab.addEventListener("click", () => {
      signupTab.classList.add("active");
      loginTab.classList.remove("active");
      signupForm.classList.add("active");
      loginForm.classList.remove("active");
      clearLoginForm();
    });

    loginTab.addEventListener("click", () => {
      loginTab.classList.add("active");
      signupTab.classList.remove("active");
      loginForm.classList.add("active");
      signupForm.classList.remove("active");
    });

    // ================================================================
    // ============ SVG ICONS FOR PASSWORD TOGGLE =====================
    // ================================================================
    const eyeIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>`;
    const eyeOffIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>`;

    function setupPasswordToggle(inputId, toggleId) {
      const passwordInput = document.getElementById(inputId);
      const toggleIcon = document.getElementById(toggleId);

      if (passwordInput && toggleIcon) {
        // Set the initial icon
        toggleIcon.innerHTML = eyeIconSVG;

        toggleIcon.addEventListener('click', function() {
          const isPassword = passwordInput.getAttribute('type') === 'password';
          if (isPassword) {
            passwordInput.setAttribute('type', 'text');
            toggleIcon.innerHTML = eyeOffIconSVG;
          } else {
            passwordInput.setAttribute('type', 'password');
            toggleIcon.innerHTML = eyeIconSVG;
          }
        });
      }
    }

    // Call the function for all three password fields
    setupPasswordToggle('password', 'togglePassword');
    setupPasswordToggle('confirmPassword', 'toggleConfirmPassword');
    setupPasswordToggle('loginPassword', 'toggleLoginPassword');

    // ================================================================
    // ================== AJAX LOGIN FORM LOGIC =======================
    // ================================================================
    loginForm.addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(loginForm);

        fetch('../backend/login.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = data.redirect;
            } else {
                alert(data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An unexpected error occurred. Please try again.');
        });
    });
</script>

</body>
</html>